<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Temporary Chat</title>
    <style>
        :root{--bg:#0f1724;--panel:#0b1220;--user:#0ea5a4;--bot:#111827;--muted:#94a3b8}
        html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,system-ui,-apple-system,"Helvetica Neue",Arial}
        body{background:linear-gradient(180deg,#071022 0%, #0b1220 100%);display:flex;align-items:center;justify-content:center;padding:24px;color:#e6eef8}
        .chat{width:100%;max-width:720px;height:80vh;display:flex;flex-direction:column;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(2,6,23,.6)}
        header{padding:12px 16px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;gap:12px}
        header h1{font-size:16px;margin:0;font-weight:600}
        header .meta{color:var(--muted);font-size:12px}
        .messages{flex:1;padding:16px;overflow:auto;display:flex;flex-direction:column;gap:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
        .msg{max-width:78%;padding:10px 14px;border-radius:12px;font-size:14px;line-height:1.3;word-wrap:break-word}
        .msg.user{align-self:flex-end;background:linear-gradient(180deg,var(--user),#10b981);color:#042022;border-bottom-right-radius:6px}
        .msg.bot{align-self:flex-start;background:linear-gradient(180deg,#0b1320,#071022);color:#cfe7ff;border-bottom-left-radius:6px}
        .meta-row{display:flex;gap:8px;align-items:center;font-size:12px;color:var(--muted);margin-bottom:6px}
        .controls{display:flex;padding:12px;background:linear-gradient(180deg,transparent,rgba(255,255,255,0.01));gap:8px}
        form{display:flex;gap:8px;flex:1}
        textarea{resize:none;height:48px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;flex:1;outline:none}
        button{background:#0ea5a4;color:#042022;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
        .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px}
        small.hint{color:var(--muted);font-size:12px;margin-left:auto}
        .muted{color:var(--muted)}
        .typing{width:48px;height:14px;display:flex;gap:6px;align-items:center}
        .dot{width:8px;height:8px;border-radius:999px;background:#9ca3af;opacity:.9;transform:translateY(0)}
        @keyframes blink {0%{opacity:.2}50%{opacity:1}100%{opacity:.2}}
        .dot:nth-child(1){animation:blink 1s infinite .1s}
        .dot:nth-child(2){animation:blink 1s infinite .3s}
        .dot:nth-child(3){animation:blink 1s infinite .5s}
    </style>
</head>
<body>
    <div class="chat" role="application" aria-label="Temporary chat">
        <header>
            <div>
                <h1>Temporary Chat</h1>
                <div class="meta">Local-only demo • messages stored in browser</div>
            </div>
            <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
                <button id="clearBtn" class="btn-ghost" title="Clear conversation">Clear</button>
                <small class="hint">Press Enter to send</small>
            </div>
        </header>

        <div id="messages" class="messages" aria-live="polite"></div>

        <div class="controls">
            <form id="form" autocomplete="off">
                <textarea id="input" aria-label="Type a message" placeholder="Write a message..." rows="1"></textarea>
                <button type="submit" title="Send">Send</button>
            </form>
        </div>
    </div>

    <script>
        // Temporary chat — client-side only, small echo bot for testing
        const STORAGE_KEY = 'temp_chat_messages_v1';
        const messagesEl = document.getElementById('messages');
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const clearBtn = document.getElementById('clearBtn');

        function loadMessages() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch {
                return [];
            }
        }

        function saveMessages(list) {
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); } catch {}
        }

        function appendMessage(role, text, opts = {}) {
            const el = document.createElement('div');
            el.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
            if (opts.showMeta) {
                const meta = document.createElement('div');
                meta.className = 'meta-row';
                const who = document.createElement('div');
                who.textContent = role === 'user' ? 'You' : 'Bot';
                const time = document.createElement('div');
                time.className = 'muted';
                time.textContent = new Date().toLocaleTimeString();
                meta.appendChild(who);
                meta.appendChild(time);
                el.appendChild(meta);
            }
            const content = document.createElement('div');
            content.textContent = text;
            el.appendChild(content);
            messagesEl.appendChild(el);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function renderAll(list) {
            messagesEl.innerHTML = '';
            for (const m of list) appendMessage(m.role, m.text, { showMeta: true });
        }

        function botReplyTo(text) {
            // Simple deterministic "echo with help" reply for local testing
            text = (text || '').trim();
            if (!text) return "I didn't receive a message. Try typing something.";
            if (/help/i.test(text)) return "This is a temporary local chat. It echoes your messages. Try: 'reverse: hello' or ask for 'time'.";
            if (/^reverse:/i.test(text)) return text.split(':').slice(1).join(':').trim().split('').reverse().join('');
            if (/time/i.test(text)) return `Local time: ${new Date().toLocaleString()}`;
            // short simulated "thinking"
            return `Echo: ${text}`;
        }

        function showTypingIndicator() {
            const el = document.createElement('div');
            el.className = 'msg bot';
            el.id = 'typing';
            const dots = document.createElement('div');
            dots.className = 'typing';
            dots.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
            el.appendChild(dots);
            messagesEl.appendChild(el);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function removeTypingIndicator() {
            const t = document.getElementById('typing');
            if (t) t.remove();
        }

        // initialize
        const state = loadMessages();
        renderAll(state);

        form.addEventListener('submit', e => {
            e.preventDefault();
            const text = input.value.trim();
            if (!text) return;
            const userMsg = {role: 'user', text, ts: Date.now()};
            state.push(userMsg);
            saveMessages(state);
            appendMessage('user', text, {showMeta: true});
            input.value = '';
            input.focus();

            // bot "typing" then reply
            showTypingIndicator();
            const delay = Math.min(1200 + text.length * 25, 2500);
            setTimeout(() => {
                removeTypingIndicator();
                const reply = {role: 'bot', text: botReplyTo(text), ts: Date.now()};
                state.push(reply);
                saveMessages(state);
                appendMessage('bot', reply.text, {showMeta: true});
            }, delay);
        });

        // ctrl+Enter inserts newline, Enter sends
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                form.requestSubmit();
            }
        });

        clearBtn.addEventListener('click', () => {
            if (!confirm('Clear chat history? This removes local messages.')) return;
            localStorage.removeItem(STORAGE_KEY);
            state.length = 0;
            renderAll(state);
            input.focus();
        });

        // focus input on load
        window.addEventListener('load', () => input.focus());
    </script>
</body>
</html>